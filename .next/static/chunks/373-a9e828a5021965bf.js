"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[373],{34373:(e,t,a)=>{a.d(t,{A:()=>w});var s=a(95155),l=a(12115),i=a(25683),r=a(25427),n=a(86989),c=a(14505),o=a(33473),d=a(38684),h=a(29191),m=a(40767),u=a(22725),x=a(60650),p=a(45220),g=a(47820),f=a(5565),j=a(26265);function w(e){let{folder:t,layout:a="grid",maxItems:w,title:b,className:v="",acceptedTypes:N="all",columns:y=3,stackStyle:k="default",href:A}=e,[C,I]=(0,l.useState)([]),[P,S]=(0,l.useState)(!0),[z,E]=(0,l.useState)(!1),[q,F]=(0,l.useState)(null),[M,_]=(0,l.useState)(null),[T,$]=(0,l.useState)(new Set),[D,O]=(0,l.useState)(new Set),[H,J]=(0,l.useState)(0),L=(0,l.useRef)(null),{isAdmin:R}=(0,n.z)(),B=async()=>{try{S(!0),F(null);let e=await fetch("/api/imagekit/list?folder=".concat(t,"&limit=50"));if(!e.ok)throw Error("미디어를 불러올 수 없습니다");let a=(await e.json()).filter(e=>{let t=/\.(jpg|jpeg|png|gif|webp|avif)$/i.test(e.name),a=/\.(mp4|webm|ogg|mov|avi)$/i.test(e.name);return"images"===N?t:"videos"===N?a:t||a}).map(e=>{let t=/\.(mp4|webm|ogg|mov|avi)$/i.test(e.name);return{url:e.url,fileId:e.fileId,name:e.name,path:e.filePath,type:t?"video":"image",thumbnail:t?"".concat(e.url,"?tr=f-jpg,q-80"):e.url}}),s=w?a.slice(0,w):a;I(s)}catch(e){F(e instanceof Error?e.message:"미디어 로드 실패")}finally{S(!1)}};(0,l.useEffect)(()=>{B()},[t,w,N]);let G=async e=>{if(e&&0!==e.length&&R)try{E(!0),J(0);for(let a=0;a<e.length;a++){let s=e[a],l=new FormData;if(l.append("file",s),l.append("folder",t),!(await fetch("/api/imagekit/upload",{method:"POST",body:l})).ok)throw Error("".concat(s.name," 업로드 실패"));J((a+1)/e.length*100)}await B()}catch(e){F(e instanceof Error?e.message:"업로드에 실패했습니다")}finally{E(!1),J(0)}},K=async(e,t)=>{if(R&&confirm("'".concat(t,"'을(를) 삭제하시겠습니까?")))try{if(!(await fetch("/api/imagekit/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileId:e})})).ok)throw Error("삭제 실패");await B()}catch(e){F("삭제에 실패했습니다")}},Q=e=>{$(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},U=e=>{O(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},V=()=>{switch(N){case"images":return"image/*";case"videos":return"video/*";default:return"image/*,video/*"}};if(P)return(0,s.jsxs)("div",{className:"flex items-center justify-center p-8 ".concat(v),children:[(0,s.jsx)(c.A,{className:"w-8 h-8 animate-spin text-white/60"}),(0,s.jsx)("span",{className:"ml-2 text-white/60",children:"로딩 중..."})]});if(q)return(0,s.jsxs)("div",{className:"text-center p-8 ".concat(v),children:[(0,s.jsx)("div",{className:"bg-red-500/20 border border-red-500/30 rounded-lg p-4 mb-4",children:(0,s.jsx)("p",{className:"text-red-300",children:q})}),(0,s.jsx)("button",{onClick:B,className:"px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition-colors",children:"다시 시도"})]});if("stack"===a){let e={default:{spread:15,rotation:8,scale:.95},spread:{spread:25,rotation:12,scale:.9},minimal:{spread:8,rotation:4,scale:.98}}[k];return(0,s.jsxs)("div",{className:v,children:[b&&(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4 text-center text-white",children:b}),R&&(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("input",{ref:L,type:"file",accept:V(),multiple:!0,onChange:e=>{e.target.files&&G(e.target.files)},className:"hidden",disabled:z}),(0,s.jsx)("button",{onClick:()=>{var e;return null===(e=L.current)||void 0===e?void 0:e.click()},disabled:z,className:"w-full flex items-center justify-center gap-2 p-3 bg-white/10 hover:bg-white/20 rounded-lg cursor-pointer transition-colors disabled:opacity-50",children:z?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.A,{className:"w-4 h-4 animate-spin"}),(0,s.jsxs)("span",{className:"text-sm",children:[Math.round(H),"%"]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.A,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"text-sm",children:"미디어 추가"})]})})]}),(0,s.jsxs)("div",{className:"relative w-full aspect-square group cursor-pointer",onClick:()=>{A&&window.open(A,"_blank")},style:{height:"400px"},children:[(0,s.jsx)(i.N,{children:0===C.length?(0,s.jsx)(r.P.div,{initial:{opacity:0},animate:{opacity:1},className:"w-full h-full border-2 border-dashed border-white/30 rounded-lg flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center text-white/50",children:[(0,s.jsx)(d.A,{className:"w-8 h-8 mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-sm",children:"미디어가 없습니다"}),R&&(0,s.jsx)("p",{className:"text-xs mt-1",children:"위의 버튼을 클릭하여 추가하세요"})]})}):C.map((t,a)=>(0,s.jsxs)(r.P.div,{className:"absolute inset-0 rounded-lg overflow-hidden shadow-xl cursor-pointer",initial:{opacity:0,scale:.8,rotate:0,x:0,y:0},animate:{opacity:1-.1*a,scale:e.scale-.02*a,rotate:(a-Math.floor(C.length/2))*e.rotation,x:(a-Math.floor(C.length/2))*e.spread,y:3*a,zIndex:C.length-a},whileHover:{scale:(e.scale-.02*a)*1.02,transition:{duration:.2}},onClick:e=>{A||(e.stopPropagation(),_(t))},style:{zIndex:C.length-a},children:["video"===t.type?(0,s.jsxs)("div",{className:"relative w-full h-full bg-black",children:[(0,s.jsx)("video",{src:t.url,className:"w-full h-full object-cover",muted:!0,loop:!0,playsInline:!0}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center",children:(0,s.jsx)(h.A,{className:"w-12 h-12 text-white opacity-80"})})]}):(0,s.jsx)(f.default,{src:(0,j.Nu)(t.url,{width:400,height:500,quality:85,format:"webp"}),alt:t.name,fill:!0,className:"object-cover",sizes:"400px",unoptimized:!0}),R&&(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),K(t.fileId,t.name)},className:"absolute top-2 right-2 p-1 bg-red-500 hover:bg-red-600 rounded-full opacity-0 group-hover:opacity-100 transition-opacity z-10",children:(0,s.jsx)(m.A,{className:"w-3 h-3 text-white"})})]},t.fileId))}),A&&C.length>0&&(0,s.jsx)(r.P.div,{className:"absolute inset-0 bg-black/20 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center pointer-events-none",style:{zIndex:1e3},children:(0,s.jsx)("span",{className:"text-white font-medium",children:"클릭하여 보기"})})]}),(0,s.jsx)("div",{className:"text-center mt-4",children:(0,s.jsxs)("span",{className:"text-xs text-white/60",children:[C.length,"개 미디어"]})})]})}return(0,s.jsxs)("div",{className:v,children:[b&&(0,s.jsx)("h3",{className:"text-2xl font-bold mb-6 text-center text-white",children:b}),R&&(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("input",{ref:L,type:"file",accept:V(),multiple:!0,onChange:e=>{e.target.files&&G(e.target.files)},className:"hidden",disabled:z}),(0,s.jsx)("button",{onClick:()=>{var e;return null===(e=L.current)||void 0===e?void 0:e.click()},disabled:z,className:"flex items-center gap-2 px-4 py-2 bg-white text-black font-medium rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:z?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.A,{className:"w-4 h-4 animate-spin"}),"업로드 중... ",Math.round(H),"%"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.A,{className:"w-4 h-4"}),"미디어 추가"]})})]}),(0,s.jsx)("div",{className:(()=>{switch(a){case"grid":return"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-".concat(y);case"masonry":return"columns-1 sm:columns-2 lg:columns-3 gap-4 space-y-4";case"carousel":return"flex gap-4 overflow-x-auto pb-4";case"stack":return"relative w-full max-w-sm mx-auto";default:return"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3"}})(),children:(0,s.jsx)(i.N,{children:0===C.length?(0,s.jsx)(r.P.div,{initial:{opacity:0},animate:{opacity:1},className:"col-span-full flex items-center justify-center p-12 border-2 border-dashed border-white/30 rounded-lg",children:(0,s.jsxs)("div",{className:"text-center text-white/50",children:[(0,s.jsx)(d.A,{className:"w-12 h-12 mx-auto mb-4"}),(0,s.jsx)("p",{children:"미디어가 없습니다"}),R&&(0,s.jsx)("p",{className:"text-sm mt-2",children:"위의 버튼을 클릭하여 추가하세요"})]})}):C.map((e,t)=>(0,s.jsxs)(r.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.8},transition:{delay:.1*t},className:"relative group cursor-pointer ".concat("carousel"===a?"flex-shrink-0 w-64":""),onClick:()=>_(e),children:[(0,s.jsxs)("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-gray-900",children:["video"===e.type?(0,s.jsxs)("div",{className:"relative w-full h-full",children:[(0,s.jsx)("video",{src:e.url,className:"w-full h-full object-cover",muted:D.has(e.fileId),autoPlay:T.has(e.fileId),loop:!0,playsInline:!0}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-colors flex items-center justify-center",children:(0,s.jsxs)("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),Q(e.fileId)},className:"p-2 bg-white/20 hover:bg-white/30 rounded-full",children:T.has(e.fileId)?(0,s.jsx)(u.A,{className:"w-4 h-4 text-white"}):(0,s.jsx)(h.A,{className:"w-4 h-4 text-white"})}),(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),U(e.fileId)},className:"p-2 bg-white/20 hover:bg-white/30 rounded-full",children:D.has(e.fileId)?(0,s.jsx)(x.A,{className:"w-4 h-4 text-white"}):(0,s.jsx)(p.A,{className:"w-4 h-4 text-white"})})]})}),(0,s.jsx)("div",{className:"absolute top-2 left-2",children:(0,s.jsx)(g.A,{className:"w-4 h-4 text-white"})})]}):(0,s.jsx)(f.default,{src:(0,j.Nu)(e.url,{width:300,height:300,quality:85,format:"webp"}),alt:e.name,fill:!0,className:"object-cover group-hover:scale-105 transition-transform duration-300",sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",unoptimized:!0}),R&&(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),K(e.fileId,e.name)},className:"absolute top-2 right-2 p-1 bg-red-500 hover:bg-red-600 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:(0,s.jsx)(m.A,{className:"w-3 h-3 text-white"})})]}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)("p",{className:"text-sm text-white/80 truncate",children:e.name})})]},e.fileId))})}),(0,s.jsx)(i.N,{children:M&&(0,s.jsx)(r.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",onClick:()=>_(null),children:(0,s.jsxs)(r.P.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},className:"relative max-w-4xl max-h-full",onClick:e=>e.stopPropagation(),children:["video"===M.type?(0,s.jsx)("video",{src:M.url,controls:!0,autoPlay:!0,className:"max-w-full max-h-full rounded-lg"}):(0,s.jsx)(f.default,{src:M.url,alt:M.name,width:1200,height:800,className:"max-w-full max-h-full object-contain rounded-lg",unoptimized:!0}),(0,s.jsx)("button",{onClick:()=>_(null),className:"absolute top-4 right-4 p-2 bg-black/50 hover:bg-black/70 rounded-full",children:(0,s.jsx)(m.A,{className:"w-6 h-6 text-white"})})]})})}),z&&(0,s.jsx)("div",{className:"fixed bottom-4 right-4 bg-black/70 backdrop-blur-sm rounded-lg p-4 text-white",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(d.A,{size:16}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"text-sm mb-1",children:["업로드 중... ",Math.round(H),"%"]}),(0,s.jsx)("div",{className:"w-48 bg-gray-600 rounded-full h-1",children:(0,s.jsx)("div",{className:"bg-green-500 h-1 rounded-full transition-all duration-300",style:{width:"".concat(H,"%")}})})]})]})})]})}}}]);