"use strict";exports.id=691,exports.ids=[691],exports.modules={26691:(e,t,s)=>{s.d(t,{A:()=>y});var a=s(45512),i=s(58009),l=s(45103),r=s(67418),n=s(43286),o=s(12592),c=s(21956),d=s(49656),u=s(44269),m=s(72744),p=s(24849),h=s(6648),x=s(31700),g=s(40953),b=s(85457);let f={publicKey:"public_2BXoL4/MDWL0GjI21rq6iIG1TF8="};async function j(e,t={}){try{let s=await fetch("/api/imagekit/auth");if(!s.ok)throw Error("Failed to get authentication parameters");let a=await s.json(),i=new FormData;i.append("file",e),i.append("publicKey",f.publicKey),i.append("signature",a.signature),i.append("expire",a.expire),i.append("token",a.token),t.fileName&&i.append("fileName",t.fileName),t.folder&&i.append("folder",t.folder),void 0!==t.useUniqueFileName&&i.append("useUniqueFileName",t.useUniqueFileName.toString()),t.tags&&t.tags.length>0&&i.append("tags",t.tags.join(",")),t.customMetadata&&i.append("customMetadata",JSON.stringify(t.customMetadata));let l=new XMLHttpRequest;return new Promise(e=>{l.upload.addEventListener("progress",e=>{if(e.lengthComputable&&t.onProgress){let s=Math.round(e.loaded/e.total*100);t.onProgress(s)}}),l.addEventListener("load",()=>{try{if(200===l.status){let t=JSON.parse(l.responseText);e({success:!0,url:t.url,fileId:t.fileId,width:t.width,height:t.height})}else{let t=JSON.parse(l.responseText);e({success:!1,error:t.message||"Upload failed"})}}catch(t){e({success:!1,error:"Failed to parse response"})}}),l.addEventListener("error",()=>{e({success:!1,error:"Network error during upload"})}),l.open("POST","https://upload.imagekit.io/api/v1/files/upload"),l.send(i)})}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}function y({src:e,alt:t,className:s="",sizes:f="100vw",onUpdate:y,onDelete:N,category:w="general",priority:v=!1,quality:k=85,showEditButton:z=!0,aspectRatio:$,placeholder:I="empty",blurDataURL:A,enableCMS:S=!0,mediaId:P}){let{isAdmin:U}=(0,g.A)(),{addMedia:C,updateMedia:D,deleteMedia:E,addActivity:F,setLoading:M,addError:L}=(0,b.A)(),[T,q]=(0,i.useState)(!1),[O,R]=(0,i.useState)(!1),[_,G]=(0,i.useState)(0),[J,W]=(0,i.useState)(null),[K,B]=(0,i.useState)(!1),[V,X]=(0,i.useState)(e),H=(0,i.useRef)(null),Q=(0,i.useCallback)(e=>{let t=e.target.files?.[0];if(t){if(!["image/jpeg","image/jpg","image/png","image/webp","image/avif"].includes(t.type)){W("Invalid file type. Please select a JPEG, PNG, WebP, or AVIF image.");return}if(t.size>0xa00000){W("File size too large. Please select an image under 10MB.");return}Y(t)}},[]),Y=async e=>{R(!0),G(0),W(null);try{let s=`img_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a=await j(e,{folder:w,fileName:`${s}_${e.name}`,useUniqueFileName:!0,onProgress:e=>{G(e)}});if(a.success&&a.url){let i={id:s,url:a.url,type:"image",alt:t||e.name,title:e.name,category:w,folder:w,width:a.width||0,height:a.height||0,size:e.size,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString(),tags:[],metadata:{originalName:e.name,fileType:e.type,...a}};S&&(C(i),F({userId:"admin",action:"upload",entityType:"media",entityId:i.id,details:`Uploaded image: ${e.name} to ${w}`})),X(a.url),y&&y(a.url),G(100),setTimeout(()=>{R(!1),G(0)},1e3)}else throw Error(a.error||"Upload failed")}catch(t){W(t instanceof Error?t.message:"Upload failed"),L(`Failed to upload ${e.name}: ${t instanceof Error?t.message:"Unknown error"}`),R(!1),G(0)}},Z=e=>{if(!e)return"/images/placeholder.jpg";if(e.startsWith("http"))return e;let t="https://ik.imagekit.io/t914/";return t?`${t}${e.startsWith("/")?e:`/${e}`}?w=1920&q=${k}&f=auto`:e};return U?(0,a.jsxs)("div",{className:`relative group ${$?`aspect-[${$}]`:""} ${s}`,onMouseEnter:()=>q(!0),onMouseLeave:()=>q(!1),children:[(0,a.jsx)("input",{ref:H,type:"file",accept:"image/*",onChange:Q,className:"hidden"}),(0,a.jsx)(l.default,{src:Z(V),alt:t,fill:!0,className:"object-cover transition-all duration-300 group-hover:brightness-75",sizes:f,priority:v,quality:k,placeholder:I,blurDataURL:A,onError:()=>X("/images/placeholder.jpg")}),(0,a.jsx)(h.N,{children:O&&(0,a.jsx)(x.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-20",children:(0,a.jsxs)("div",{className:"text-center text-white",children:[(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-white/30 border-t-white rounded-full animate-spin mb-4 mx-auto"}),(0,a.jsx)("p",{className:"text-sm font-medium",children:"Uploading..."}),(0,a.jsxs)("p",{className:"text-xs text-gray-300 mt-1",children:[_,"%"]}),(0,a.jsx)("div",{className:"w-32 h-1 bg-white/30 rounded-full mt-2 overflow-hidden",children:(0,a.jsx)(x.P.div,{className:"h-full bg-white rounded-full",initial:{width:"0%"},animate:{width:`${_}%`},transition:{duration:.3}})})]})})}),(0,a.jsx)(h.N,{children:J&&(0,a.jsx)(x.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute inset-0 bg-red-500/90 backdrop-blur-sm flex items-center justify-center z-20",children:(0,a.jsxs)("div",{className:"text-center text-white p-4",children:[(0,a.jsx)(r.A,{size:24,className:"mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm font-medium mb-2",children:"Upload Error"}),(0,a.jsx)("p",{className:"text-xs",children:J}),(0,a.jsx)("button",{onClick:()=>W(null),className:"mt-2 px-3 py-1 bg-white/20 rounded-lg text-xs hover:bg-white/30 transition-colors",children:"Dismiss"})]})})}),(0,a.jsx)(h.N,{children:T&&z&&!O&&(0,a.jsx)(x.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-10",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>{H.current?.click()},className:"p-2 bg-blue-500 hover:bg-blue-600 rounded-lg transition-colors",title:"Replace Image",children:(0,a.jsx)(n.A,{size:16,className:"text-white"})}),S&&P&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>{S&&P&&F({userId:"admin",action:"edit",entityType:"media",entityId:P,details:`Duplicated image: ${t}`})},className:"p-2 bg-green-500 hover:bg-green-600 rounded-lg transition-colors",title:"Duplicate Image",children:(0,a.jsx)(o.A,{size:16,className:"text-white"})}),(0,a.jsx)("button",{onClick:()=>B(!K),className:"p-2 bg-purple-500 hover:bg-purple-600 rounded-lg transition-colors",title:"More Actions",children:(0,a.jsx)(c.A,{size:16,className:"text-white"})})]}),N&&(0,a.jsx)("button",{onClick:()=>{N&&N(),S&&P&&(E(P),F({userId:"admin",action:"delete",entityType:"media",entityId:P,details:`Deleted image: ${t}`}))},className:"p-2 bg-red-500 hover:bg-red-600 rounded-lg transition-colors",title:"Delete Image",children:(0,a.jsx)(d.A,{size:16,className:"text-white"})})]})})}),(0,a.jsx)(h.N,{children:K&&S&&(0,a.jsxs)(x.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"absolute top-4 right-4 bg-black/90 backdrop-blur-sm rounded-lg p-3 z-30 min-w-48",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h4",{className:"text-white text-sm font-medium",children:"Image Actions"}),(0,a.jsx)("button",{onClick:()=>B(!1),className:"text-gray-400 hover:text-white",children:(0,a.jsx)(u.A,{size:14})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("button",{onClick:()=>navigator.clipboard.writeText(V),className:"w-full flex items-center gap-2 px-3 py-2 text-xs text-white hover:bg-white/10 rounded transition-colors",children:[(0,a.jsx)(o.A,{size:12}),"Copy URL"]}),(0,a.jsxs)("button",{onClick:()=>window.open(V,"_blank"),className:"w-full flex items-center gap-2 px-3 py-2 text-xs text-white hover:bg-white/10 rounded transition-colors",children:[(0,a.jsx)(c.A,{size:12}),"View Full Size"]}),(0,a.jsxs)("div",{className:"border-t border-gray-600 pt-2",children:[(0,a.jsxs)("p",{className:"text-xs text-gray-400 mb-1",children:["Category: ",w]}),P&&(0,a.jsxs)("p",{className:"text-xs text-gray-400",children:["ID: ",P]})]})]})]})}),O&&(0,a.jsx)("div",{className:"absolute top-2 right-2 z-30",children:(0,a.jsx)("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:(0,a.jsx)(m.A,{size:12,className:"text-white"})})}),100===_&&(0,a.jsx)(x.P.div,{initial:{scale:0},animate:{scale:1},exit:{scale:0},className:"absolute top-2 right-2 z-30",children:(0,a.jsx)("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:(0,a.jsx)(p.A,{size:12,className:"text-white"})})})]}):(0,a.jsx)("div",{className:`relative ${$?`aspect-[${$}]`:""} ${s}`,children:(0,a.jsx)(l.default,{src:Z(V),alt:t,fill:!0,className:"object-cover",sizes:f,priority:v,quality:k,placeholder:I,blurDataURL:A,onError:()=>X("/images/placeholder.jpg")})})}}};